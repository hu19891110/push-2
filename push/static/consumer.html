<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Notification Consumer</title>
    <script src="jschannel.js"></script>
    <script src="jquery-underscore-backbone.js"></script>
    <style>
      #send {
        display: none;
      }
    </style>
  </head>
  <body>
    <h1>Web Notifications</h1>
    <div>
      <div id="enable">
        <button>Enable notifications.</button>
      </div>
      <div id="send">
        <form method="post">
          <input id="message" placeholder="Send a message.">
          <button id="click">Send a message.</button>
        </form>
      </div>
    </div>
    <script src="include.js"></script>
    <script>
      var queue;
      if (navigator.notifications) {
        console.log('checking in consumer');
        navigator.notifications.checkPermission(function(q) {
          console.log('ok');
          if (q) {
            enable(q);
          } else {
            $('#enable button').click(function(e) {
              e.preventDefault();
              navigator.notifications.requestPermission(enable);
            });
          };
        });
      }

      $('#send form').submit(function(e) {
        e.preventDefault();
        $.post('/example/queue/',
               {queue: queue, message: $('#message').val()});
        $('#message').val('');
      });

      function enable(q) {
        queue = q;
        $('#enable').hide();
        $('#send').show();
      }
    </script>
  </body>
</html>
